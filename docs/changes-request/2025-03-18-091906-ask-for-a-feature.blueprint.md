---
name: Ask for a feature
created-at: 2025-03-18T09:19:06+01:00
user-stories:
  - title: Ask for a feature
    file: docs/user-stories/basic-commands/06-ask-for-a-feature.md
    content-hash: 15f634bcb0df76f11241f94d3987865c

---

# Blueprint

## Overview

This blueprint outlines the implementation plan for the "Ask for a feature" command. This command will allow users to submit feature suggestions to the CLI developer through a structured process, collecting necessary information and submitting it via a Slack webhook.

## Implementation Plan

### Phase 1: Core Command Structure

1. **Create Feature Request Command**
   - Create new file `cmd/feature.go`
   - Implement the `feature` command using Cobra
   - Add subcommand `ask` for feature requests
   - Register commands in `init()`

2. **Define Data Models**
   ```go
   // internal/models/feature_request.go
   type FeatureRequest struct {
       Title              string    `json:"title"`
       Description        string    `json:"description"`
       Importance        string    `json:"importance"`
       UserStory         UserStory `json:"user_story"`
       AcceptanceCriteria []string  `json:"acceptance_criteria"`
       CreatedAt         time.Time `json:"created_at"`
   }

   type UserStory struct {
       AsA     string `json:"as_a"`
       IWant   string `json:"i_want"`
       SoThat  string `json:"so_that"`
   }
   ```

### Phase 2: Interactive Input Collection

1. **Create Feature Request Builder**
   - Implement a TUI form using `charmbracelet/bubbles`
   - Create input fields for all required information:
     - Title
     - Description
     - Importance
     - User story components (As a..., I want..., So that...)
     - Acceptance criteria (multiple entries)
   - Allow interruption at any point
   - Save progress in a hidden file

2. **Implement Progress Persistence**
   - Save partial progress in `.usm/feature-requests/<timestamp>.json`
   - Load existing progress when command is restarted
   - Clean up file after successful submission

### Phase 3: Slack Integration

1. **Create Slack Client**
   ```go
   // internal/slack/client.go
   type Client struct {
       webhookURL string
   }

   type Message struct {
       Blocks []Block `json:"blocks"`
   }

   func NewClient(webhookURL string) *Client
   func (c *Client) SendFeatureRequest(fr *models.FeatureRequest) error
   ```

2. **Implement Message Formatting**
   - Create a well-formatted Slack message using blocks
   - Include all feature request details
   - Add formatting for better readability

### Phase 4: File Management

1. **Implement File Operations**
   ```go
   // internal/io/feature_request.go
   func SaveProgress(fr *models.FeatureRequest) error
   func LoadProgress() (*models.FeatureRequest, error)
   func CleanupProgress() error
   ```

2. **Create Hidden Directory Structure**
   - Create `.usm` directory if not exists
   - Create `.usm/feature-requests` for progress files
   - Implement cleanup of old files

### Phase 5: User Interface

1. **Design Interactive Flow**
   ```
   1. Welcome message
   2. Title input
   3. Description input
   4. Importance input
   5. User story components:
      - "As a..." input
      - "I want..." input
      - "So that..." input
   6. Acceptance criteria:
      - Add multiple criteria
      - Option to add more
   7. Review all inputs
   8. Confirmation prompt
   9. Success/failure message
   ```

2. **Implement Progress Indicators**
   - Show current step in the process
   - Display completion percentage
   - Indicate saved progress status

### Phase 6: Error Handling

1. **Implement Robust Error Handling**
   - Handle network errors when sending to Slack
   - Handle file system errors
   - Provide clear error messages with recovery steps
   - Implement automatic retry for Slack submission

2. **Add Validation**
   - Validate all required fields
   - Check for minimum content lengths
   - Validate webhook URL format
   - Ensure acceptance criteria is not empty

### Phase 7: Testing

1. **Unit Tests**
   ```go
   // cmd/feature_test.go
   func TestFeatureRequestCommand(t *testing.T)
   func TestProgressPersistence(t *testing.T)
   func TestSlackIntegration(t *testing.T)
   ```

2. **Integration Tests**
   - Test full feature request flow
   - Test interruption and recovery
   - Test Slack message formatting
   - Test file operations

### Phase 8: Documentation

1. **Update CLI Help**
   ```go
   var askCmd = &cobra.Command{
       Use:   "ask",
       Short: "Submit a feature request",
       Long: `Submit a feature request to the CLI developer.
   
   This command will guide you through the process of submitting a feature request.
   You can interrupt the process at any time, and your progress will be saved.
   
   The feature request will include:
   - Title and description
   - Importance to your workflow
   - User story format (As a..., I want..., so that...)
   - Acceptance criteria
   
   Example:
     usm feature ask`,
   }
   ```

2. **Update README.md**
   - Add section about feature requests
   - Include example usage
   - Document all command options

## Implementation Details

### Command Structure

```go
// cmd/feature.go
package cmd

import (
    "github.com/spf13/cobra"
    "github.com/user-story-matrix/usm/internal/feature"
)

var featureCmd = &cobra.Command{
    Use:   "feature",
    Short: "Manage feature requests",
    Long:  `Commands for managing feature requests and suggestions.`,
}

var askCmd = &cobra.Command{
    Use:   "ask",
    Short: "Submit a feature request",
    Long:  `Submit a feature request to the CLI developer.`,
    RunE: func(cmd *cobra.Command, args []string) error {
        return feature.RunAskFlow()
    },
}

func init() {
    rootCmd.AddCommand(featureCmd)
    featureCmd.AddCommand(askCmd)
}
```

### Feature Request Flow

```go
// internal/feature/flow.go
func RunAskFlow() error {
    // 1. Initialize or load saved progress
    fr, err := loadOrCreateFeatureRequest()
    if err != nil {
        return err
    }

    // 2. Run interactive input collection
    if err := collectInputs(fr); err != nil {
        return err
    }

    // 3. Show confirmation prompt
    if confirmed := confirmSubmission(fr); !confirmed {
        return nil
    }

    // 4. Submit to Slack
    if err := submitToSlack(fr); err != nil {
        return err
    }

    // 5. Cleanup saved progress
    return cleanup(fr)
}
```

## Acceptance Criteria Validation

✅ Command implemented as `usm feature ask`
✅ Collects all required information:
  - Title
  - Description
  - Importance
  - User story format
  - Acceptance criteria
✅ Saves progress in hidden file
✅ Can be interrupted and resumed
✅ Submits to Slack webhook
✅ Includes confirmation step
✅ Provides clear feedback throughout the process

## Technical Dependencies

- `github.com/spf13/cobra` - CLI framework
- `github.com/charmbracelet/bubbles` - TUI components
- `github.com/charmbracelet/lipgloss` - Terminal styling
- Standard library packages:
  - `encoding/json` - For progress file handling
  - `net/http` - For Slack webhook calls
  - `path/filepath` - For file path handling
  - `time` - For timestamps

## Future Enhancements

1. Add support for attachments (screenshots, logs)
2. Implement feature request status tracking
3. Add command to list submitted feature requests
4. Add support for templates
5. Add support for multiple notification channels
